@using Stardome.DomainObjects
﻿@model Stardome.Models.ContentModel
@Scripts.Render("~/Scripts/jsTree")
@Scripts.Render("~/Scripts/bootstrap")
@Styles.Render("~/Content/jsTree")
@Styles.Render("~/Content/bootstrap")
@if (Request.IsAuthenticated == false)
{
    Response.Redirect("~/Account/Login");
}
@if (Model.RoleId != (int)Enums.Roles.Admin && Model.RoleId != (int)Enums.Roles.Producer && Model.RoleId != (int)Enums.Roles.User)
{
    Response.Redirect("~/Account/Login");
}
@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>@ViewBag.Message</h1>
            </hgroup>
        </div>
    </section>
}
<html>
<head>
    <meta charset="utf-8">
    <title>Content</title>
    <script type="text/javascript">

        var Role = '@Model.RoleId';  
        var UserId = '@WebSecurity.CurrentUserId';   

        root = '@System.Web.HttpUtility.JavaScriptStringEncode(Server.MapPath("~/Stardome"))' + '\\';
       
        $(document).ready(function () {
            initializer(Role);

            $('.btn-file :file').on('fileselect', function (event, numFiles, label) {

                var input = $(this).parents('.input-group').find(':text'),
                    log = numFiles > 1 ? numFiles + ' files selected' : label;

                if (input.length) {
                    input.val(log);
                } else {
                    if (log) alert(log);
                }

            });
        });
        $(document).on('change', '.btn-file :file', function () {
            var input = $(this),
                numFiles = input.get(0).files ? input.get(0).files.length : 1,
                label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
            input.trigger('fileselect', [numFiles, label]);
        });
    </script>
</head>
<body>
    <div>
        <table id="labels">
            <tr>               
                <td><div id="dropD"></div></td>
                <td>Files For Download</td>
            </tr>
        </table>
    </div>
    <div class="outer">        
        <div class="innerwrap">
            <div id="MainTree"></div>
            <div id="selectedFileList"></div>
        </div>
    </div>

    <div id="dialog-confirm"></div>    
    <div style="float:left; width:100%">
        @if (Model.RoleId == (int)Enums.Roles.Admin || Model.RoleId == (int)Enums.Roles.Producer)
        {
            using (Html.BeginForm("Actions", "Manage", new { lastSelected = Model.RootPath }, FormMethod.Post, new { enctype = "multipart/form-data" })) //lastSelected must equal
            {
                <label id="lastDir"></label>                
        <h4>Upload files</h4>
        <table style="width: 100%">
            <tr>
            <td style="width: 40%">
                <div class="col-lg-6 col-sm-6 col-12" style="width: 100%">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <span class="btn btn-primary btn-file">
                                Browse&hellip; <input type="file" multiple>
                            </span>
                        </span>
                        <input type="text" class="form-control" readonly>
                    </div>
                </div>
            </td>
            <td><button type="submit" class="btn btn-primary">Upload Files</button></td>
            <td style="width: 30%"></td>
            <td><button type="button" class="btn btn-primary" onclick="downloadAsZip()">Download as Zip</button></td>
            </tr>
     </table>



                <br>
                @ViewBag.Message<br>
                foreach (var element in Model.List)
                {
                    <p>@Html.DisplayFor(m => element)</p>
                }
            }
        }
    </div>
    <div>
                
    </div>
    <br /><br /><br /><br /><br /><br /><br />
    <div>
        <h1 id="qunit-header">QUnit Tests</h1>
        <ol id="qunit-tests"></ol>
    </div>
</body>
</html>

